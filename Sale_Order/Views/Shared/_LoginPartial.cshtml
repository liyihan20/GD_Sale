@using Sale_Order.Models;
@{
    string[] powers = (string[])ViewData["powers"];
    string depName = ViewData["depName"] as string;
}

<ul id="menu_tree" class="easyui-tree" style="visibility:hidden">
    <li><span>@Html.Lang("invoice_manage")</span>
        <ul>
            @if ((Array.IndexOf(powers, Powers.new_order.ToString()) != -1) || (Array.IndexOf(powers, Powers.ceo_excel.ToString()) != -1) || (Array.IndexOf(powers, Powers.chk_dep_bills.ToString()) != -1))
            {
            <li><span>@Html.Lang("sale_order")</span>
                <ul>
                    @if (Array.IndexOf(powers, Powers.new_order.ToString()) != -1) {
                        <li id="~/Saler/ChooseCompany?actionName=CreateSaleOrder&companys=光电总部,光电仁寿"><span>@Html.Lang("new_sale_order")</span> </li>
                        <li id="~/Saler/CheckAllOrders?bill_type=1"><span>@Html.Lang("check_add_apply")</span> </li>
                        @*<li id="~/NSaler/ChooseCompany?billType=SO"><span>@Html.Lang("new_sale_order")</span> </li>
                        <li id="~/NSaler/CheckBillList?billType=SO"><span>@Html.Lang("check_add_apply")</span> </li>*@
                    }
                    @if (Array.IndexOf(powers, Powers.ceo_excel.ToString()) != -1)
                    {
                        <li id="downCeoExcel"><span>@Html.Lang("ceo_excel")</span> </li>
                    }
                    @if (Array.IndexOf(powers, Powers.chk_dep_bills.ToString()) != -1)
                    {
                        <li id="~/Authority/CheckProcBills"><span>@Html.Lang("chk_dep_bills")</span> </li>  
                    }
                </ul>
            </li>
            }
            @if ((Array.IndexOf(powers, Powers.new_model.ToString()) != -1))
             {
            <li><span>@Html.Lang("model_bill")</span>
                <ul>                    
                    <li id="~/Authority/FetchModualNumber"><span>获取开模序号</span></li>
                    <li id="~/Saler/ChooseCompany?actionName=CreateCCMModelContract&companys=光电总部,光电仁寿"><span>@Html.Lang("create_ccm_model_bill")</span> </li>                     
                    <li id="~/Saler/ChooseCompany?actionName=CreateModelContract"><span>@Html.Lang("create_model_bill")</span> </li>
                    <li id="~/Saler/CheckAllOrders?bill_type=3"><span>@Html.Lang("check_add_apply")</span> </li>
                    @*<li id="~/NSaler/CreateBill?billType=CC"><span>@Html.Lang("create_ccm_model_bill")</span> </li>
                    <li id="~/NSaler/ChooseCompany?billType=CM"><span>@Html.Lang("create_model_bill")</span> </li>
                    <li id="~/NSaler/CheckBillList?billType=CM"><span>@Html.Lang("check_add_apply")</span> </li>*@
                </ul>
            </li> 
             }
            @if ((Array.IndexOf(powers, Powers.new_sample.ToString()) != -1) || (Array.IndexOf(powers, Powers.agency_sb_excel.ToString()) != -1))
            {
            <li><span>@Html.Lang("sample_invoice")</span>
                <ul>
                    <li id="~/Saler/ChooseCompany?actionName=CreateSampleBill&companys=光电总部,光电仁寿"><span>@Html.Lang("create_sample_bill")</span> </li>
                    @*<li id="~/Saler/ChooseCompany?actionName=CreateSampleBill"><span>@Html.Lang("create_sample_bill")</span> </li>*@
                    @if (Array.IndexOf(powers, Powers.agency_sb_excel.ToString()) != -1) { 
                        <li id="downAgencyExcel">办事处报表</li>
                    }
                    <li id="~/Saler/CheckAllOrders?bill_type=4"><span>@Html.Lang("check_add_apply")</span> </li>
                    @*<li id="~/NSaler/CheckBillList?billType=SB"><span>@Html.Lang("check_add_apply")</span> </li>*@
                </ul>
            </li> 
            }
            @if (Array.IndexOf(powers, Powers.new_BL.ToString()) != -1 || Array.IndexOf(powers, Powers.bus_check_bl.ToString()) != -1) {
                <li>
                    <span>备料单</span>
                    <ul>
                        @if (Array.IndexOf(powers, Powers.new_BL.ToString()) != -1) { 
                            <li id="~/Saler/CreateBLBill"><span>新建备料单</span></li>
                            <li id="~/Saler/CheckAllOrders?bill_type=5"><span>@Html.Lang("check_add_apply")</span> </li>
                        }
                        @if (Array.IndexOf(powers, Powers.bus_check_bl.ToString()) != -1) {
                            <li id="~/NExtra/CheckBusBLs"><span>接单员查看列表</span></li>
                        }
                    </ul>
                </li>
            }
            @if ((Array.IndexOf(powers, Powers.new_TH.ToString()) != -1) || (Array.IndexOf(powers, Powers.TH_manage.ToString()) != -1) || (Array.IndexOf(powers, Powers.depHasAudit_notInK3.ToString()) != -1))
            {
            <li><span>退换货管理</span>
                <ul>
                    @if (Array.IndexOf(powers, Powers.new_TH.ToString()) != -1)
                    {
                    <li id="~/BadProduct/SelectStockBill"><span>新增退换货申请</span></li>
                    <li id="~/BadProduct/CheckAllReturnBill"><span>查看退换货申请</span></li>
                    }                    
                    @if (Array.IndexOf(powers, Powers.TH_manage.ToString()) != -1)
                    {    
                    <li id="~/Authority/CheckReturnBillsBackground"><span>退换货申请管理</span></li>
                    }
                    @if (Array.IndexOf(powers, Powers.depHasAudit_notInK3.ToString()) != -1)
                    { 
                    <li id="~/Authority/CheckDepHasAuditNotInK3"><span>已审核未导入K3</span></li>
                    }
                </ul>
            </li>
            }
            @if (Array.IndexOf(powers, Powers.new_CH.ToString()) != -1 || Array.IndexOf(powers, Powers.delivery_bill.ToString()) != -1 || Array.IndexOf(powers, Powers.sign_delivery_bill.ToString()) != -1 ) { 
            @*<li>
                <span>出货申请单</span>
                <ul>
                    @if (Array.IndexOf(powers, Powers.new_CH.ToString()) != -1) { 
                    <li id="~/NSaler/ChooseCompany?billType=CH"><span>新增出货申请</span> </li>   
                    <li id="~/NSaler/CheckBillList?billType=CH"><span>查看新增申请</span> </li>   
                    <li id="~/NExtra/CheckCHSOList"><span>K3订单出货记录</span> </li>
                    }
                    @if (Array.IndexOf(powers, Powers.delivery_bill.ToString()) != -1) { 
                    <li id="~/NExtra/CheckCHList4Log">维护送货单</li>
                    }
                    @if (Array.IndexOf(powers, Powers.sign_delivery_bill.ToString()) != -1) { 
                    <li id="~/NExtra/CheckCHSignList">送货单回签</li>
                    }
                </ul>
            </li>*@
            }
            <li id="~/Audit/CheckAuditList"><span>@Html.Lang("audit_add_apply")</span> </li>
            @*<li id="~/NAudit/CheckNAuditList"><span>审批出货申请</span> </li>*@
            @if (Array.IndexOf(powers, Powers.ceo_batch_audit.ToString()) != -1) {
                <li id="~/Authority/CeoBatchAudit"><span>总裁办批量审批</span></li>
            }
            @if (Array.IndexOf(powers, Powers.uploadQualityReport.ToString()) != -1)
            { 
                <li id="~/Authority/UploadQualityReport"><span>上传品质报告</span> </li>
            }
        </ul>
    </li>
    @if (Array.IndexOf(powers, Powers.dep_manage.ToString()) != -1 || Array.IndexOf(powers, Powers.user_manage.ToString()) != -1
                    || Array.IndexOf(powers, Powers.group_manage.ToString()) != -1 || Array.IndexOf(powers, Powers.agency_rel_auditor.ToString()) != -1
                    || Array.IndexOf(powers, Powers.edit_proc_auditor.ToString()) != -1)
    {
        <li><span>@Html.Lang("User_depart")</span>
            <ul>
                @if (Array.IndexOf(powers, Powers.dep_manage.ToString()) != -1)
                {
                    <li id="~/Authority/Departments"><span>@Html.Lang("dep_manage")</span> </li>
                }
                @if (Array.IndexOf(powers, Powers.user_manage.ToString()) != -1)
                {
                    <li id="~/Authority/Users"><span>@Html.Lang("user_manage")</span> </li>
                }
                @if (Array.IndexOf(powers, Powers.group_manage.ToString()) != -1)
                {
                    <li id="~/Authority/Groups"><span>@Html.Lang("group_manage")</span> </li>
                }
                @if (Array.IndexOf(powers, Powers.process_manage.ToString()) != -1)
                {
                    <li id="~/Authority/Processes"><span>@Html.Lang("process_manage")</span> </li>
                }
                @if (Array.IndexOf(powers, Powers.edit_proc_auditor.ToString()) != -1)
                {
                    <li id="~/Authority/ProcDepAuditor"><span>@Html.Lang("dep_auditor_manage")</span> </li>
                }
            </ul>
        </li>
    }
    @if (depName.Contains("市场") || depName.Contains("办事处") || depName.Contains("本部") || depName.Contains("中心")) { 
        <li><span>@Html.Lang("mat_manage")</span>
            <ul>
                 @if (Array.IndexOf(powers, Powers.cur_manage.ToString()) != -1)
                 {
                    <li id="~/Authority/Currency"><span>@Html.Lang("cur_manage")</span> </li>
                 }
                 @if (Array.IndexOf(powers, Powers.bak_bill.ToString()) != -1)
                 {
                    <li id="~/Authority/CheckBillsBackground"><span>@Html.Lang("bak_bill")</span> </li>
                 }
                 @*@if (Array.IndexOf(powers, Powers.reset_password.ToString()) != -1)
                 {
                    <li id="~/Authority/ResetPassword"><span>@Html.Lang("reset_password")</span> </li>
                 }*@
                 @if (Array.IndexOf(powers, Powers.chk_process.ToString()) != -1)
                 {
                    <li id="~/Authority/ProcExcuteTime"><span>@Html.Lang("proc_time")</span> </li>
                 }
                 @if (Array.IndexOf(powers, Powers.order_number_manage.ToString()) != -1)
                 {
                    <li id="~/Authority/OrderNumberManage"><span>@Html.Lang("order_number_manage")</span> </li>
                    <li id="~/Authority/ModualNumberIndex"><span>开模序号管理</span></li>
                    <li id="~/Authority/CheckModualNumLog"><span>开模序号获取记录</span></li>
                 }
                 @if (Array.IndexOf(powers, Powers.modify_bill_no.ToString()) != -1) {
                    <li id="~/Authority/ModifyBillNo"><span>单号修改</span> </li>
                 }
                 @if (Array.IndexOf(powers, Powers.clerk_customer.ToString()) != -1) { 
                <li id="~/NExtra/ClerkAndCustomer"><span>营业与客户</span></li>
                }                
                <li id="~/NExtra/ItemModelAndCustomer"><span>产品/客户/部门关系</span></li>                
            </ul>
        </li>
    }
</ul>
@Html.Partial("_DownloadCeoExcelPartial")
@Html.Partial("_DownloadAgencyExcelPartial")
<script type="text/javascript">
    $(function () {
        $('#menu_tree').tree({
            onClick: function (node) {
                if (node.id == "downCeoExcel") {
                    $("#dlg_ceoExcel").dialog("open");
                } else if (node.id == "downAgencyExcel") {
                    $("#dlg_agencyExcel").dialog("open");
                }
                else if (node.id) {
                    $("iframe").attr("src", node.id);
                }
            }
        });

        $('#menu_tree').css("visibility", "visible");
    });
    
</script>
